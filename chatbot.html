<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Between covers</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --bg: #7c7c72; --card-bg: #f0eaea; --border: #000000;
  --text: #ffffff; --text-light: #ede1e1;
  --primary:  #495c4b; --primary-hover:  #2e302f; --accent: #0e3f2f;
  --shadow: 0 20px 40px rgba(32, 22, 22, 0.3),0 10px 20px rgba(0,0,0,0.2);
  --radius: 24px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body, html{
  height:100%;
  font-family:'Tajawal',sans-serif;
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:auto;
  background-image:url('https://www.thezoombackgrounds.com/cdn/shop/files/1HCuDy8u_hw5F80pxcLRE1rMplhbWbai3.jpg');
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
}

/* Ø§Ù„ÙƒØ§Ø±Ø¯ ÙÙŠ ÙˆØ³Ø· Ø§Ù„ØµÙØ­Ø© â€“ Ø£ÙƒØ¨Ø± ÙˆØ£ÙˆØ³Ø¹ */
#card {
  position: fixed;
  top: 45%; /* ØªÙ… Ø±ÙØ¹Ù‡ Ù„Ù„Ø£Ø¹Ù„Ù‰ */
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90vw;
  max-width: 1000px; 
  height: 85vh;
  max-height: 800px;
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  backdrop-filter: blur(16px);
  display: none;
  z-index: 999;
  animation: fadeUp 0.3s ease;
}


@keyframes fadeUp {
  from { opacity: 0; transform: translate(-50%, -45%); }
  to { opacity: 1; transform: translate(-50%, -50%); }
}

.card-header {
  padding: 22px;
  background: linear-gradient(135deg,var(--primary),#686c8e);
  color: white;
  text-align: center;
  flex-shrink: 0;
}
.card-header h3 { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
.card-header p { font-size: 15px; opacity: 0.92; }

.card-body {
  flex: 1;
  padding: 18px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 14px;
  min-height: 0;
}
.card-body::-webkit-scrollbar { width: 8px; }
.card-body::-webkit-scrollbar-thumb { background: #000000; border-radius: 10px; }

.msg {
  max-width: 85%;
  padding: 15px 20px;
  border-radius: 18px;
  font-size: 15.5px;
  line-height: 1.55;
  word-wrap: break-word;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.msg.user {
  align-self: flex-end;
  background: rgb(179, 168, 168);
  color: rgb(0, 0, 0);
  border-bottom-right-radius: 6px;
}
.msg.bot {
  align-self: flex-start;
  background: #373937;
  color: var(--text);
  border-bottom-left-radius: 6px;
  border: 1px solid var(--border);
}

.msg-source {
  font-size: 11px;
  color: #fc5454;
  margin-bottom: 4px;
  font-weight: 500;
}

.card-footer {
  flex-shrink: 0;
  padding: 14px 18px;
  background: #495c4b;
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.input-container {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

#userInput {
  flex: 1;
  min-height: 44px;
  max-height: 130px;
  padding: 12px 16px;
  border: 1.5px solid var(--border);
  border-radius: 22px;
  font-size: 15px;
  outline: none;
  background: #353b43;
  color: var(--text);
  resize: none;
  overflow-y: auto;
  transition: all 0.25s ease;
  font-family: inherit;
  line-height: 1.45;
}
#userInput:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(160, 161, 210, 0.25);
  background:#353b43;
}
  #userInput::placeholder{ color: #94a3b8; }

.btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 17px;
  cursor: pointer;
  background:  #495c4b;
  color: var(--text-light);
  transition: all 0.25s ease;
  flex-shrink: 0;
}
.btn:hover { background: #42433f; transform: translateY(-1px); }
#sendBtn { background: var(--primary); color: white; }
#sendBtn:hover { background: var(--primary-hover); }
#fileBtn { background: #373937; color: white; }
#fileBtn:hover { background: #059669; }

.file-input-container {
  position: relative;
  display: inline-block;
}

#fileInput {
  position: absolute;
  left: -9999px;
}

#typing {
  align-self: flex-start;
  background: #373937;
  color: var(--text);
  padding: 12px 18px;
  border-radius: 18px;
  border-bottom-left-radius: 6px;
  font-style: italic;
  font-size: 14px;
  display: flex;
  gap: 6px;
  align-items: center;
  border: 1px solid var(--border);
}
#typing span {
  width: 8px;
  height: 8px;
  background: var(--accent);
  border-radius: 50%;
  animation: pulse 1.5s infinite;
}
#typing span:nth-child(2) { animation-delay: 0.2s; }
#typing span:nth-child(3) { animation-delay: 0.4s; }
@keyframes pulse {
  0%,100%{transform:scale(0.8);opacity:0.6;}
  50%{transform:scale(1.2);opacity:1;}
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨ */
#chat-toggle {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 70px;
  height: 70px;
  background: var(--primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  transition: all 0.25s;
  z-index: 1000;
}
#chat-toggle:hover {
  background: var(--primary-hover);
  transform: scale(1.1);
}
#chat-toggle img { width: 45px; height: 45px; }

#customer-info-outside {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #2e3141;
  color: var(--text);
  padding: 12px 0;
  font-size: 14px;
  text-align: center;
  border-top: 1px solid var(--border);
  z-index: 998;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 24px;
}

.social-icon {
  color: var(--text-light);
  font-size: 20px;
  transition: color 0.3s ease;
  text-decoration: none;
}
.social-icon:hover {
  color: var(--primary);
}

#suggestions {
  color: #f87171;
  font-size: 13px;
  text-align: right;
  min-height: 18px;
  padding: 0 5px;
}

.upload-info {
  font-size: 12px;
  color: var(--text-light);
  text-align: center;
  margin-top: 5px;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
.correction-feedback {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
  border-radius: 8px;
  padding: 8px 12px;
  margin: 5px 0;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: slideIn 0.3s ease-out;
}

.correction-feedback i {
  color: #10b981;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

@media(max-width:768px){
  #card{width:96vw;height:80vh;}
  .card-header{padding:18px;}
  .card-body{padding:14px;}
  .card-footer{padding:12px 14px;}
  #customer-info-outside{flex-direction:column;gap:10px;padding:10px 0;}
}
</style>
</head>
<body>


<div id="card">
  <div class="card-header">
    <h3>Ø¨ÙŠÙ† Ø§Ù„ØºÙ„Ø§ÙÙŠÙ†</h3>
    <p>"Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„ÙƒØªØ¨ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªØŒ Ù†Ø­Ù† Ù‡Ù†Ø§ Ø¯Ø§Ø¦Ù…Ù‹Ø§!"</p>
  </div>
  <div class="card-body" id="chatBody"></div>
  <div class="card-footer">
    <div id="suggestions"></div>
    <div class="input-container">
      <button id="fileBtn" class="btn" title="Ø±ÙØ¹ Ù…Ù„Ù Ù„Ù„Ù†Ù‚Ø¯"><i class="fas fa-file-upload"></i></button>
      <div class="file-input-container">
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt">
      </div>
      <button id="micBtn" class="btn"><i class="fas fa-microphone"></i></button>
      <textarea id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."></textarea>
      <button id="sendBtn" class="btn"><i class="fas fa-paper-plane"></i></button>
    </div>
    <div class="upload-info">ÙŠØ¯Ø¹Ù…: PDF, Word, TXT (Ø­ØªÙ‰ 10MB)</div>
  </div>
</div>

<div id="customer-info-outside">

  <strong>Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:</strong>

  <a href="mailto:betweencovers@gmail.com" class="social-icon">
    <span dir="ltr"><i class="fas fa-envelope"></i> betweencovers@gmail.com</span>
  </a>

  <a href="https://x.com/betweencovers01" class="social-icon" target="_blank">
    <span dir="ltr"><i class="fab fa-x-twitter"></i>
</i> @betweencovers01</span>
  </a>

  <a href="https://instagram.com/betweencovers02" class="social-icon" target="_blank">
    <span dir="ltr"><i class="fab fa-instagram"></i> @betweencovers02</span>
  </a>

  <a href="https://t.me/betweencovers03" class="social-icon" target="_blank">
    <span dir="ltr"><i class="fab fa-telegram"></i> @betweencovers03</span>
  </a>

</div>


<script>
const chatBody = document.getElementById('chatBody');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
const fileBtn = document.getElementById('fileBtn');
const fileInput = document.getElementById('fileInput');

const card = document.getElementById('card');
const suggestionsDiv = document.getElementById('suggestions');
const SERVER_URL = 'http://localhost:3000';

// =================== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† ===================
const autoCorrections = {
    "Ø¨Ø­Ø¨": "Ø£Ø­Ø¨", "Ø¹Ø§ÙˆØ²": "Ø£Ø±ÙŠØ¯", "Ø§Ø¨ØºØ§": "Ø£Ø±ÙŠØ¯", "Ø§ÙŠÙ‡": "Ù…Ø§Ø°Ø§", 
    "Ù„ÙŠÙ‡": "Ù„Ù…Ø§Ø°Ø§", "Ø¹Ø´Ø§Ù†": "Ù„Ø£Ù†", "Ù‡ÙŠØ¹Ù…Ù„": "Ø³ÙŠÙØ¹Ù„", "Ù…Ø´": "Ù„ÙŠØ³",
    "Ù‚Ø±Ø§ÙŠÙ‡": "Ù‚Ø±Ø§Ø¡Ø©", "Ø³Ø¹Ø§Ø¯Ù‡": "Ø³Ø¹Ø§Ø¯Ø©", "Ø§Ù†Ø§": "Ø£Ù†Ø§", "Ø¬Ø¯Ø§Ø§Ø§": "Ø¬Ø¯Ù‹Ø§",
    "ÙƒØªÙŠØ±": "ÙƒØ«ÙŠØ±", "ØµÙØ­Ù‡": "ØµÙØ­Ø©", "Ù…ÙƒØªØ¨Ù‡": "Ù…ÙƒØªØ¨Ø©", "Ø±ÙˆØ§ÙŠÙ‡": "Ø±ÙˆØ§ÙŠØ©",
    "Ø«Ù‚Ø§ÙÙ‡": "Ø«Ù‚Ø§ÙØ©", "Ù…Ø¹Ø±ÙÙ‡": "Ù…Ø¹Ø±ÙØ©", "Ø±Ø§Ø­Ù‡": "Ø±Ø§Ø­Ø©", "Ù†ÙØ³ÙŠÙ‡": "Ù†ÙØ³ÙŠØ©",
    "Ø«Ù‚Ù‡": "Ø«Ù‚Ø©", "Ù‚Ø±Ø§Ø¡Ù‡": "Ù‚Ø±Ø§Ø¡Ø©", "Ù…Ø­ÙÙˆØ²": "Ù…Ø­ÙÙˆØ¸", "Ù†Ø¬ÙŠØ¨ Ù…Ø­ÙÙˆØ²": "Ù†Ø¬ÙŠØ¨ Ù…Ø­ÙÙˆØ¸",
    "ÙƒÙØªÙ‘Ø§Ø¨": "ÙƒÙØªÙ‘ÙØ§Ø¨", "ÙƒØªØ§Ø¨": "ÙƒØªØ§Ø¨", "ÙƒØªØ¨": "ÙƒØªØ¨", "Ù…Ø¤Ù„Ù": "Ù…Ø¤Ù„Ù", "ÙƒØ§ØªØ¨": "ÙƒØ§ØªØ¨"
};

function applyAutoCorrection(text) {
    let corrected = text;
    for (const [wrong, correct] of Object.entries(autoCorrections)) {
        const regex = new RegExp(`\\b${wrong}\\b`, 'gi');
        corrected = corrected.replace(regex, correct);
    }
    return corrected;
}

function showCorrectionFeedback(original, corrected, corrections) {
    if (corrections && corrections.correctionsCount > 0) {
        const correctionInfo = document.createElement('div');
        correctionInfo.className = 'correction-feedback';
        correctionInfo.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-magic"></i>
                <small>ØªÙ… ØªØµØ­ÙŠØ­ ${corrections.correctionsCount} ÙƒÙ„Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</small>
            </div>
        `;
        const lastMessage = chatBody.lastChild;
        if (lastMessage) {
            chatBody.insertBefore(correctionInfo, lastMessage);
        }
    }
}

function openChat(){
  card.style.display='flex';
  if(!chatBody.innerHTML.includes('Ù…Ø±Ø­Ø¨Ù‹Ø§')){
    addBot('Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ <strong style="color:#FFFAF0;">Ø¨ÙˆØª Ø¨ÙŠÙ† Ø§Ù„ØºÙ„Ø§ÙÙŠÙ†</strong><br>Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:<br>â€¢ ØªØ±Ø´ÙŠØ­Ø§Øª Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„<br>â€¢ Ù†Ù‚Ø¯ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ<br>â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª<br>â€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªÙƒ<br><br>Ø§ÙƒØªØ¨ Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù Ù„Ù„Ù†Ù‚Ø¯!','between covers');
  }
}
// Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±:
// chatToggle.onclick=()=>{card.style.display=(card.style.display==='flex')?'none':'flex';if(card.style.display==='flex') openChat();}

// Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯:
// === ÙØªØ­ Ø§Ù„Ø´Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ 2 Ø«ÙˆØ§Ù†ÙŠ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø£ÙŠÙ‚ÙˆÙ†Ø© ===
setTimeout(() => {
  card.style.display = 'flex';
  openChat(); // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
}, 2000);
let isSending=false;
function sendMessage(){
  if(isSending) return;
  let text=userInput.value.trim();
  if(!text) return;
  
  isSending=true;
  
  const originalText = text;
  text = applyAutoCorrection(text);
  
  addUser(text); 
  userInput.value=''; 
  adjustInputHeight(); 
  suggestionsDiv.innerHTML='';
  showTyping();
  
  fetch(`${SERVER_URL}/chat`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:text})
  })
  .then(res=>res.json())
  .then(data=>{
    hideTyping();
    addBot(data.reply.replace(/\n/g,'<br>'),data.source);
    
    if (data.corrections && data.corrections.correctionsCount > 0) {
        showCorrectionFeedback(originalText, text, data.corrections);
    }
  })
  .catch(()=>{
    hideTyping(); 
    addBot('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.','Error');
  })
  .finally(()=>{isSending=false;});
}
sendBtn.onclick=sendMessage;

// Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù†Ù‚Ø¯
fileBtn.onclick=()=>fileInput.click();
fileInput.onchange=function(e){
  const file=e.target.files[0];
  if(!file) return;
  
  if(file.size>10*1024*1024){
    alert('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB');
    return;
  }
  
  addUser(`ğŸ“„ ${file.name}`);
  showTyping();
  
  const formData=new FormData();
  formData.append('file',file);
  
  fetch(`${SERVER_URL}/upload`,{
    method:'POST',
    body:formData
  })
  .then(res=>res.json())
  .then(data=>{
    hideTyping();
    addBot(data.reply.replace(/\n/g,'<br>'),data.source);
  })
  .catch(err=>{
    hideTyping();
    addBot('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù.','Error');
  })
  .finally(()=>{
    fileInput.value='';
  });
};

function adjustInputHeight(){userInput.style.height='44px';userInput.style.height=(userInput.scrollHeight)+'px';}
userInput.addEventListener('input',()=>{adjustInputHeight(); checkArabicSpelling();});
userInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}});

function addUser(txt){const m=document.createElement('div');m.className='msg user';m.innerHTML=txt.replace(/\n/g,'<br>');chatBody.appendChild(m);scroll();}
function addBot(html,source){
  const m=document.createElement('div');m.className='msg bot';
  m.innerHTML=`<div class="msg-source">${source}</div>`+html;
  chatBody.appendChild(m);scroll();
}
function showTyping(){hideTyping();const t=document.createElement('div');t.id='typing';t.innerHTML='<span></span><span></span><span></span> ÙŠÙƒØªØ¨ Ø§Ù„Ø§Ù†...';chatBody.appendChild(t);scroll();}
function hideTyping(){const t=document.getElementById('typing');if(t) t.remove();}
function scroll(){chatBody.scrollTop=chatBody.scrollHeight;}

const arabicWords = [
  // === Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø© ===
  "ÙƒØªØ§Ø¨", "ÙƒØªØ¨", "Ù…ÙƒØªØ¨Ø©", "Ø±ÙˆØ§ÙŠØ©", "Ø±ÙˆØ§ÙŠØ§Øª", "Ù‚ØµØ©", "Ù‚ØµØµ", "Ù‚ØµØµ Ø£Ø·ÙØ§Ù„",
  "Ø±ÙˆØ§ÙŠØ© Ù‚ØµÙŠØ±Ø©", "Ø±ÙˆØ§ÙŠØ© Ø·ÙˆÙŠÙ„Ø©", "Ù…Ø¤Ù„Ù", "ÙƒØ§ØªØ¨", "ÙƒÙØªÙ‘Ø§Ø¨", "Ù…Ø¤Ù„ÙÙŠÙ†", "ÙƒØ§ØªØ¨ÙŠÙ†",
  "Ù‚Ø±Ø§Ø¡Ø©", "Ù‚Ø±Ø§Ø¡", "Ø§Ù‚Ø±Ø£", "ØµÙØ­Ø©", "ØµÙØ­Ø§Øª", "ÙØµÙ„", "Ø§Ù„ÙØµÙ„", "Ø¬Ø²Ø¡", "Ù…Ø±Ø§Ø¬Ø¹Ø©",
  "Ù†Ù‚Ø¯", "Ø£Ù†Ù‚Ø¯", "ÙƒØªØ§Ø¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "Ù…ÙƒØªØ¨Ø© Ø±Ù‚Ù…ÙŠØ©", "Ù‚Ø±Ø§Ø¡Ø© Ù…Ù…ØªØ¹Ø©", "Ù…Ø«ÙŠØ±", "Ù…Ø´ÙˆÙ‚",
  "Ø®ÙŠØ§Ù„", "Ù…ØºØ§Ù…Ø±Ø©", "ØªØ³Ù„ÙŠØ©", "Ø£Ø¯Ø¨", "Ø´Ø¹Ø±", "Ù‚Ø§ÙÙŠØ©", "Ø´ÙˆÙ‚ÙŠ", "Ø­ÙƒÙ…Ø©", "Ø¨ÙŠØª",
  "Ø§Ù„ÙØ³ØªÙ‚", "Ù†Ø¸Ø±ÙŠØ©", "Ø­Ø³ÙŠÙ†", "Ø·Ù‡", "Ù…Ø­ÙÙˆØ¸", "Ù†Ø¬ÙŠØ¨", "Ù†Ø¬ÙŠØ¨ Ù…Ø­ÙÙˆØ¸",

  // === Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ ÙˆØ§Ù„Ù…Ø¬Ø§Ù„Ø§Øª ===
  "ÙÙ„Ø³ÙØ©", "Ø¯ÙŠÙ†", "Ø¯ÙŠÙ†ÙŠØ©", "ØªÙØ³ÙŠØ±", "Ù‚Ø±Ø¢Ù†", "Ù‚Ø±Ø§Ù†", "ØµØ­Ø©", "Ø¹Ù„ÙˆÙ…", "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§",
  "ÙÙ†", "Ù…ÙˆØ³ÙŠÙ‚Ù‰", "Ø±ÙŠØ§Ø¶Ø©", "Ø«Ù‚Ø§ÙØ©", "ØªØ¹Ù„ÙŠÙ…", "Ø¨Ø­Ø«", "Ø¥Ø¨Ø¯Ø§Ø¹", "ØªØ·ÙˆÙŠØ±", "ØªØ­ÙÙŠØ²",
  "Ø´Ø®ØµÙŠØ©", "Ù…Ø¤Ù„Ù Ù…Ø´Ù‡ÙˆØ±", "ÙƒØªØ§Ø¨ Ù…Ø´Ù‡ÙˆØ±", "Ù†ØµØ§Ø¦Ø­", "Ø£Ø®Ø¨Ø§Ø±", "Ù…ÙˆØ¶ÙˆØ¹", "Ø¹Ù†ÙˆØ§Ù†",

  // === Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ===
  "Ø£Ø±ÙŠØ¯", "Ø§Ø¨ØºØ§", "Ø§Ø¹Ø·ÙŠÙ†ÙŠ", "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ø³Ø¤Ø§Ù„", "Ø§Ù‚ØªØ±Ø§Ø­", "Ø§Ø³Ù…", "Ø¹Ø¯Ø¯", "Ù„ØºØ©",
  "ØªØ¹Ù„Ù…", "ØªØ¬Ø±Ø¨Ø©", "Ù…Ø¨ØªØ¯Ø¦", "Ù…Ø­ØªØ±Ù", "Ù…ØªÙ‚Ø¯Ù…", "Ø§Ù†Ø¬Ø­", "Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©", "ØµØ­Ø­", "Ø¯Ø§ÙŠÙ…Ù‹Ø§",

  // === Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø³ÙŠØ§Ù‚ ===
  "ÙƒÙŠÙ", "Ù…Ù†", "Ù‡Ùˆ", "Ø£Ù†Ø§", "Ù‡Ù†Ø§", "Ø§ÙƒØªØ¨", "Ø£ÙŠ", "Ø¹Ø¯Ø¯", "Ø§Ù„Ø£Ø³Ø¦Ù„Ø©", "Ø§Ù„Ø­Ù‚Ù„",
  "Ø§Ù„ÙŠÙˆÙ…", "Ù‚ØµÙŠØ¯Ø©", "ØºØ²ÙˆØ©", "Ø£Ø­Ø¯", "ØºØ²ÙˆØ© Ø£Ø­Ø¯", "ÙƒØ§Ù†Øª", "Ù…ØªÙ‰", "Ù…Ø³ÙˆÙŠ", "Ø£ÙŠØ´",

  // === ÙƒÙ„Ù…Ø§Øª Ø¯ÙŠÙ†ÙŠØ© ÙˆØªØ§Ø±ÙŠØ®ÙŠØ© ===
  "Ø§Ù„ØµØ¨Ø±", "Ù†ÙØ³Ù‡Ø§", "Ø­ÙˆÙ„", "Ø§Ù„Ø³Ø§Ø¹Ø©", "Ù…Ø®ØªØ±Ø¹", "ØªØ¯ÙˆØ±", "Ø§Ù„Ø£Ø±Ø¶", "Ø¨Ø§Ù„Ø¬Ù†Ø©",
  "Ø§Ù„Ù…Ø¨Ø´Ø±ÙŠÙ†", "Ø§Ù„Ø¹Ø´Ø±Ø©", "Ù‡Ù…",

  // === Ø§Ù„Ù„Ù‡Ø¬Ø§Øª ÙˆØ§Ù„Ø¹Ø§Ù…ÙŠØ© ===
  "Ø§Ù„Ø³Ù„Ø§Ù…", "Ø¹Ù„ÙŠÙƒÙ…", "Ù…Ø±Ø­Ø¨Ø§", "Ø­Ø§Ù„Ùƒ", "Ø®Ø¯Ù…Ø©", "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡", "Ù†Ø­Ù†", "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",
  "Ø£Ø­Ù…Ø¯",
  
];

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§)
function removeTashkeel(text){
  return text.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g,'');
}

function levenshtein(a,b){
  const matrix = Array.from({length:a.length+1},()=>Array(b.length+1).fill(0));
  for(let i=0;i<=a.length;i++) matrix[i][0]=i;
  for(let j=0;j<=b.length;j++) matrix[0][j]=j;
  for(let i=1;i<=a.length;i++){
    for(let j=1;j<=b.length;j++){
      const cost=a[i-1]===b[j-1]?0:1;
      matrix[i][j]=Math.min(matrix[i-1][j]+1,matrix[i][j-1]+1,matrix[i-1][j-1]+cost);
    }
  }
  return matrix[a.length][b.length];
}

function similarity(a,b){
  a=removeTashkeel(a).toLowerCase();
  b=removeTashkeel(b).toLowerCase();
  const distance=levenshtein(a,b);
  return 1-distance/Math.max(a.length,b.length);
}

function checkArabicSpelling(){
  const text=userInput.value.trim();
  if(!text) return suggestionsDiv.innerHTML="";
  const words=text.split(/\s+/);
  let result="";
  words.forEach(word=>{
    const cleanWord=removeTashkeel(word).toLowerCase();
    const found=arabicWords.some(w=>removeTashkeel(w).toLowerCase()===cleanWord);
    if(!found){
      const suggestion=arabicWords.map(w=>({w,score:similarity(cleanWord,removeTashkeel(w).toLowerCase())}))
        .sort((a,b)=>b.score-a.score)[0];
      if(suggestion.score>0.6){
        result+=`${word}: Ø§Ù‚ØªØ±Ø§Ø­ â†’ ${suggestion.w}<br>`;
      }else{
        result+=`${word}: ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡<br>`;
      }
    }
  });
  suggestionsDiv.innerHTML=result;
}

// =================== Ø¯Ø¹Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ===================
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
const rec=SpeechRecognition?new SpeechRecognition():null;let recording=false;
if(rec){rec.lang='ar-SA';rec.continuous=false;
rec.onresult=e=>{const transcript=e.results[0][0].transcript;userInput.value+=(userInput.value?'\n':'')+transcript;adjustInputHeight();checkArabicSpelling();}
rec.onend=()=>{recording=false;micBtn.innerHTML='<i class="fas fa-microphone"></i>';}}
micBtn.onclick=()=>{if(!rec) return alert('Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');if(recording) rec.stop();else{rec.start();recording=true;micBtn.innerHTML='<i class="fas fa-stop"></i>';}}
adjustInputHeight();
</script>
</body>
</html>